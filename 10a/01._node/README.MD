# ğŸ“š 10a - Document A Database (Knex + PostgreSQL)

## âœ… Opgaveformulering
    Use a tool to document any database.â€

Jeg har valgt at bruge Knex.js til at oprette og dokumentere en PostgreSQL-database. Knex gÃ¸r det muligt at definere database-skemaer med kode, tracke Ã¦ndringer (migrations), indsÃ¦tte testdata (seeds) og versionere databasen nemt i et udviklingsprojekt.

Type: Individual
Valgt database: PostgreSQL
Tool anvendt: Knex.js (query builder og migrationsvÃ¦rktÃ¸j)

Denne opgave dokumenterer en PostgreSQL-database ved hjÃ¦lp af **Knex.js** â€“ et SQL query builder-vÃ¦rktÃ¸j for Node.js.  
Knex bruges her til at **oprette tabeller (migrations)** og **indsÃ¦tte testdata (seeds)**.

---

## ğŸ§© Hvordan virker koden?

### 1. Konfiguration
- `knexfile.js` indeholder databasekonfigurationen (hvilken database, bruger, password, host osv.).
- MiljÃ¸variabler hentes fra `.env`-filen.

### 2. Migrationer
- I mappen `/migrations` findes migrationsfiler, fx `20250411093547_create_users_products_table.js`.
- Her defineres tabellerne `users` og `products` med deres felter og datatyper.

### 3. Seeds
- I mappen `/seeds` findes seed-filer, fx `seed_users.js`, som indsÃ¦tter testdata i tabellerne.

### 4. Integration med applikationen
- I `index.js` integreres Knex med applikationen:
  - Her importeres Knex og konfigurationen.
  - Forbindelsen til databasen oprettes:
    ```js
    // INTEGRATION POINT: Her integreres Knex med applikationen ved at oprette en databaseforbindelse
    const db = knex(knexConfig);
    ```
  - Herefter kan du lave queries mod databasen via `db`-objektet.

### 5. KÃ¸rsel
- Migrationer og seeds kÃ¸res med Knex CLI:
  - `npx knex migrate:latest` opretter tabellerne.
  - `npx knex seed:run` indsÃ¦tter testdata.

---

## ğŸ“ Hvor sker integrationen?
- **Integration sker i `index.js`** hvor fÃ¸lgende linje opretter forbindelsen mellem Node.js og databasen via Knex:
  ```js
  // INTEGRATION POINT: Her integreres Knex med applikationen ved at oprette en databaseforbindelse
  const db = knex(knexConfig);
  ```

---

## âœ… Fordele og ulemper ved denne lÃ¸sning

### Fordele
- **Kodebaseret skemadefinition:** Alt database-design og Ã¦ndringer versionstyres i kode.
- **Nem versionering:** Migrationer gÃ¸r det let at spole frem/tilbage i databaseÃ¦ndringer.
- **Automatiseret testdata:** Seeds gÃ¸r det nemt at fylde testdata pÃ¥ databasen.
- **MiljÃ¸uafhÃ¦ngig:** Kan nemt flyttes mellem udviklingsmiljÃ¸er (Docker, lokal, cloud).
- **Let at integrere med Node.js:** Knex fungerer godt sammen med moderne JavaScript/TypeScript.

### Ulemper
- **Abstraktion:** Man mister noget af den "rÃ¥" SQL-fÃ¸lelse og kontrol.
- **LÃ¦ringskurve:** KrÃ¦ver forstÃ¥else for bÃ¥de Knex og SQL.
- **Mindre egnet til meget komplekse queries:** Knex er bedst til simple til moderate queries.

---

## ğŸ§± Struktur af databasen
ğŸ”¹ Tabeller

users

    id â€“ integer, primÃ¦r nÃ¸gle
    first_name â€“ varchar(255)
    last_name â€“ varchar(255)

products

    id â€“ integer, primÃ¦r nÃ¸gle
    name â€“ varchar(1000)
    price â€“ decimal

---

## ğŸ› ï¸ Implementeringsproces
1. Initiering

    npm init -y
    npm install knex pg dotenv
    npx knex init

2. Migration: Opret skema

    npx knex migrate:make create_users_products_table
    npx knex migrate:latest

3. Seed data

    npx knex seed:make seed_users
    npx knex seed:run

4. Verificering

    docker exec -it <container_id> psql -U myuser -d mydatabase
    \dt
    SELECT * FROM users;

---

## ğŸ§° Teknologier brugt

| Teknologi       | Beskrivelse                             |
|----------------|------------------------------------------|
| **PostgreSQL**  | Relationsdatabase, hostet i Docker       |
| **Knex.js**     | Migrations + seeding + SQL abstraction   |
| **Docker Compose** | Starter container med DB + volume persistence |
| **psql**        | CLI-vÃ¦rktÃ¸j til at tilgÃ¥ og inspicere databasen |

---

## ğŸ—ï¸ Struktur & Data

### ğŸ”¹ Tabeller
```text
users
â”œâ”€â”€ id (int, primary key)
â”œâ”€â”€ first_name (varchar)
â””â”€â”€ last_name (varchar)

products
â”œâ”€â”€ id (int, primary key)
â”œâ”€â”€ name (varchar)
â””â”€â”€ price (decimal)
```

---

## Eksempeldata (fra seeding)

-- SELECT * FROM users;
+----+------------+-----------+
| id | first_name | last_name|
+----+------------+-----------+
| 1  | John       | Doe       |
| 2  | Jane       | Smith     |
| 3  | Alice      | Johnson   |
+----+------------+-----------+

---

## ğŸ“¦ Backup & Dokumentation (Bonus)

Backup kan foretages via:

    docker exec -T <container_id> pg_dump -U myuser mydatabase > pgdump.sql

Dokumentation er i denne README

Migrationer og seeds findes i mapperne:

    /migrations
    /seeds
```